// SECURITY FILE: Intentional XSS vulnerabilities

import { useEffect, useRef, useState } from "react";

interface Comment {
  id: number;
  author: string;
  content: string;
  timestamp: Date;
}

interface UserProfile {
  name: string;
  bio: string;
  website: string;
}

// VULNERABILITY 1: dangerouslySetInnerHTML with user input
function CommentDisplay({ comment }: { comment: Comment }) {
  // VULNERABLE: XSS via dangerouslySetInnerHTML
  return (
    <div className="comment">
      <strong>{comment.author}</strong>
      <div dangerouslySetInnerHTML={{ __html: comment.content }} />
    </div>
  );
}

// VULNERABILITY 2: innerHTML assignment
function UserBio({ bio }: { bio: string }) {
  const bioRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    // VULNERABLE: XSS via innerHTML
    if (bioRef.current) {
      bioRef.current.innerHTML = bio;
    }
  }, [bio]);

  return <div ref={bioRef} className="bio" />;
}

// VULNERABILITY 3: document.write
function DynamicContent({ content }: { content: string }) {
  useEffect(() => {
    // VULNERABLE: XSS via document.write
    document.write(content);
  }, [content]);

  return null;
}

// VULNERABILITY 4: eval with user input
function Calculator({ expression }: { expression: string }) {
  const [result, setResult] = useState<string>("");

  useEffect(() => {
    try {
      // VULNERABLE: Code injection via eval
      setResult(eval(expression).toString());
    } catch (e) {
      setResult("Error");
    }
  }, [expression]);

  return <div>Result: {result}</div>;
}

// VULNERABILITY 5: href with javascript: protocol
function UserLink({ profile }: { profile: UserProfile }) {
  // VULNERABLE: XSS via javascript: URL
  return <a href={profile.website}>Visit {profile.name}&apos;s website</a>;
}

// VULNERABILITY 6: Unsanitized URL in src
function UserAvatar({ avatarUrl }: { avatarUrl: string }) {
  // VULNERABLE: Could load malicious script if URL is javascript:
  return <img src={avatarUrl} alt="Avatar" />;
}

// VULNERABILITY 7: outerHTML manipulation
function ReplaceContent({ newHtml }: { newHtml: string }) {
  const containerRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    // VULNERABLE: XSS via outerHTML
    if (containerRef.current) {
      containerRef.current.outerHTML = newHtml;
    }
  }, [newHtml]);

  return <div ref={containerRef}>Original content</div>;
}

// VULNERABILITY 8: insertAdjacentHTML
function AppendContent({ htmlToAppend }: { htmlToAppend: string }) {
  const containerRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    // VULNERABLE: XSS via insertAdjacentHTML
    if (containerRef.current) {
      containerRef.current.insertAdjacentHTML("beforeend", htmlToAppend);
    }
  }, [htmlToAppend]);

  return <div ref={containerRef} />;
}

// VULNERABILITY 9: Template literals in DOM
function CreateElement({
  tagName,
  content,
}: {
  tagName: string;
  content: string;
}) {
  const containerRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    // VULNERABLE: XSS via template literal HTML construction
    if (containerRef.current) {
      containerRef.current.innerHTML = `<${tagName}>${content}</${tagName}>`;
    }
  }, [tagName, content]);

  return <div ref={containerRef} />;
}

// VULNERABILITY 10: window.location manipulation
function RedirectHandler({ redirectUrl }: { redirectUrl: string }) {
  useEffect(() => {
    // VULNERABLE: Open redirect / XSS via javascript: URL
    window.location.href = redirectUrl;
  }, [redirectUrl]);

  return <div>Redirecting...</div>;
}

// VULNERABILITY 11: postMessage without origin check
function MessageReceiver() {
  useEffect(() => {
    const handleMessage = (event: MessageEvent) => {
      // VULNERABLE: No origin check, accepting messages from any source
      document.getElementById("output")!.innerHTML = event.data;
    };

    window.addEventListener("message", handleMessage);
    return () => window.removeEventListener("message", handleMessage);
  }, []);

  return <div id="output" />;
}

// VULNERABILITY 12: setAttribute with user input
function DynamicAttributes({
  attrName,
  attrValue,
}: {
  attrName: string;
  attrValue: string;
}) {
  const elementRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    // VULNERABLE: XSS via setAttribute (e.g., onclick attribute)
    if (elementRef.current) {
      elementRef.current.setAttribute(attrName, attrValue);
    }
  }, [attrName, attrValue]);

  return <div ref={elementRef}>Dynamic attributes element</div>;
}

export {
  AppendContent,
  Calculator,
  CommentDisplay,
  CreateElement,
  DynamicAttributes,
  DynamicContent,
  MessageReceiver,
  RedirectHandler,
  ReplaceContent,
  UserAvatar,
  UserBio,
  UserLink,
};
